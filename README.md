# P115StrgmSub - 115网盘订阅追更插件

MoviePilot 插件，自动将订阅的电视剧缺失剧集从 115 网盘分享链接转存到个人网盘。

## 完整工作流

本插件配合 [115网盘STRM助手](https://github.com/DDSRem-Dev/MoviePilot-Plugins) 可实现完整的自动化追剧流程：

```
MoviePilot订阅 -> 本插件搜索转存 -> STRM助手生成STRM -> 媒体库刮削 -> 播放器观看
```

| 步骤 | 负责插件 | 说明 |
|------|----------|------|
| 1. 订阅管理 | MoviePilot | 添加电视剧订阅，跟踪缺失剧集 |
| 2. 资源搜索转存 | P115StrgmSub | 搜索115分享链接，转存缺失剧集到网盘 |
| 3. STRM生成 | 115网盘STRM助手 | 监控网盘目录，生成STRM文件 |
| 4. 刮削入库 | MoviePilot/媒体服务器 | 识别STRM文件，刮削元数据 |
| 5. 播放观看 | Emby/Infuse/VidHub | 通过302重定向播放115网盘视频 |

## 功能特点

- 自动获取 MoviePilot 中状态为"订阅中"的电视剧订阅
- 通过 PanSou 服务搜索 115 网盘分享资源
- 智能匹配剧集文件，支持 S01E01、第X集、EP01 等多种命名格式
- 自动检查网盘目录已有文件，避免重复转存
- 记录转存历史，防止同一集重复处理
- 支持定时任务和手动触发

## 依赖

- p115client>=0.0.8.2
- PanSou 网盘搜索服务（需自行部署或使用第三方服务）

## 配置说明

### 基础配置

| 配置项 | 说明 |
|--------|------|
| 启用插件 | 开启/关闭插件 |
| 发送通知 | 转存完成后发送消息通知 |
| 执行周期 | 5位cron表达式，留空默认每6小时执行 |
| 转存目录 | 115网盘保存路径，默认 `/我的接收/MoviePilot` |

### 115 网盘配置

可以直接从115网盘STRM助手复制Cookie。

### PanSou 配置

| 配置项 | 说明 |
|--------|------|
| API 地址 | PanSou 服务地址 |
| 启用认证 | 服务是否需要登录认证 |
| 用户名/密码 | 认证凭据 |
| TG 搜索频道 | 可选，指定 Telegram 频道列表，逗号分隔 |

## 使用方法

1. 安装依赖：`pip install p115client`
2. 在 MoviePilot 插件管理中安装本插件
3. 配置 115 Cookie 和 PanSou 服务地址
4. 确保 MoviePilot 中有电视剧订阅
5. 启用插件，等待定时任务执行或手动运行


## 转存路径结构

```
{转存目录}/{剧名}/Season {季号}/
例如: /我的接收/MoviePilot/黑暗荣耀/Season 1/
```

## 注意事项

- 本插件只处理电视剧订阅，不处理电影
- 115 Cookie 有效期有限，失效后需重新获取
- PanSou 搜索结果取决于资源库收录情况
- 转存后文件需要等待 115 挂载同步才能被 MoviePilot 识别入库
