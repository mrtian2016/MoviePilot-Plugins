# P115StrgmSub - 115网盘订阅追更插件

MoviePilot 插件，自动将订阅的电影和电视剧从 115 网盘分享链接转存到个人网盘。

## 新增功能：
支持自定义插件运行时间，强制执行间隔不低于8h。
支持两种触发条件恢复系统订阅运行，条件一：每天最后一次任务结束后延迟生效；条件二：手动关闭屏蔽系统订阅立即生效。支持订阅模式切换后订阅站点选择。

## 完整工作流

本插件配合 [115网盘STRM助手](https://github.com/DDSRem-Dev/MoviePilot-Plugins) 可实现完整的自动化追剧流程：

```
MoviePilot订阅 -> 本插件搜索转存 -> STRM助手生成STRM -> 媒体库刮削 -> 播放器观看
```

## 功能特点

- **支持电影和电视剧**订阅自动追更
- **三重搜索源**：Nullbr（TMDB ID 精准匹配）+ PanSou（网盘聚合搜索）
- **智能匹配**：支持 S01E01、第X集、EP01 等多种命名格式
- **洗版模式**：自动升级更高质量资源（基于订阅的质量/分辨率/特效设置）
- **订阅过滤**：继承 MoviePilot 订阅的质量、分辨率、特效过滤条件
- **屏蔽系统订阅**：可阻止 MoviePilot 默认的订阅下载，仅使用本插件转存
- **避免重复**：自动检查网盘已有文件和历史记录
- **自动完成订阅**：转存完成后自动标记订阅完成
- **防风控机制**：批量转存、速率限制、智能重试

## 依赖

```bash
pip install p115client>=0.0.8.2 sqlitetools>=0.0.7 playwright
```



## 配置说明

### 基础配置

| 配置项 | 说明 |
|--------|------|
| 启用插件 | 开启/关闭插件 |
| 发送通知 | 转存完成后发送消息通知 |
| 执行周期 | cron表达式，默认每8小时执行 |
| 电视剧转存目录 | 默认 `/我的接收/MoviePilot/TV` |
| 电影转存目录 | 默认 `/我的接收/MoviePilot/Movie` |

### 115 网盘配置

填入 115 Cookie（可从115网盘STRM助手复制）

### 搜索源配置

插件支持三个搜索源，按优先级自动回退。可同时启用多个，若当前源找不到资源会自动尝试下一个。

**Nullbr**（TMDB精准匹配）:
- APP ID 和 API Key
- 基于 TMDB ID 查询，准确率高


**PanSou**（网盘聚合搜索）:
- API 地址、用户名/密码（可选认证）
- TG 搜索频道（可选），为空的话将搜索 PanSou 默认频道
- 资源丰富，但需要通过标题匹配

### 高级配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 只搜索115资源 | 开启 | PanSou 搜索时只返回115网盘资源 |
| 屏蔽系统订阅 | 关闭 | 阻止 MoviePilot 默认订阅处理 |
| 排除订阅 | - | 指定不处理的订阅ID（逗号分隔） |
| 单次同步最大转存数 | 50 | 防风控限制 |
| 批量转存每批数量 | 20 | 批量转存时每批文件数 |
| 跳过其他季目录 | 开启 | 减少不必要的 API 调用 |

## 转存路径结构

```
电视剧: {电视剧目录}/{剧名}/Season {季号}/
电影:   {电影目录}/{片名} ({年份})/
```

## UI 统计功能

插件提供详细的统计信息展示：
- 总转存数、今日转存、成功率
- 电影/剧集分类统计
- 最近同步时间
- 历史记录列表（支持清空）

## 远程命令

支持通过 MoviePilot 消息触发同步：
```
/p115_sync
```

## 使用方法

1. 在 MoviePilot 插件管理中安装本插件
2. 配置 115 Cookie
3. 配置至少一个搜索源（Nullbr 或 PanSou）
4. 在 MoviePilot 中添加订阅
5. 启用插件，等待定时任务执行或点击"立即搜索"按钮

## 注意事项

- 115 Cookie 有效期有限，失效后需重新获取
- 搜索结果取决于资源库收录情况
- 洗版模式需要在订阅中开启"洗版"选项
- 建议合理设置转存数量限制，避免触发 115 风控
